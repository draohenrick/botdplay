<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Conversas - Dplay Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
            <div class="position-sticky sidebar-sticky">
                <div class="text-center my-4">
                    <h6 class="sidebar-heading px-3 text-dark"><span>Dplay Bot</span></h6>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item"><a class="nav-link" href="index.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="instances.html">ConexÃµes</a></li>
                    <li class="nav-item"><a class="nav-link active" href="conversations.html">Conversas</a></li>
                    <li class="nav-item"><a class="nav-link" href="leads.html">Leads</a></li>
                    <li class="nav-item"><a class="nav-link" href="services.html">Configurar Bot</a></li>
                    <li class="nav-item"><a class="nav-link" href="usuarios.html">UsuÃ¡rios</a></li>
                    <li class="nav-item mt-auto"><a class="nav-link" href="account.html">Minha Conta</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="logout()">Logout</a></li>
                </ul>
            </div>
        </nav>

        <!-- ConteÃºdo principal -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="page-header d-flex justify-content-between align-items-center my-3">
                <h1>Conversas</h1>
                <button class="btn btn-outline-light btn-sm" id="refresh-btn">ðŸ”„ Atualizar</button>
            </div>
            
            <p>Visualize o histÃ³rico de conversas dos seus bots.</p>

            <!-- Filtros -->
            <div class="card mb-3">
                <div class="card-body d-flex flex-wrap gap-2 align-items-center">
                    <input type="text" id="search-conversation" class="form-control form-control-sm w-auto" placeholder="Buscar por nome ou nÃºmero...">
                    <select id="status-filter" class="form-select form-select-sm w-auto">
                        <option value="all">Todas</option>
                        <option value="active">Ativas</option>
                        <option value="closed">Finalizadas</option>
                    </select>
                </div>
            </div>

            <!-- Lista de conversas -->
            <div class="card">
                <div class="card-body">
                    <div id="conversations-container" class="list-group">
                        <div class="text-center text-muted py-3">Carregando conversas...</div>
                    </div>
                </div>
            </div>
        </main>
      </div>
    </div>

    <!-- Modal para visualizar conversa -->
    <div class="modal fade" id="conversationModal" tabindex="-1" aria-labelledby="conversationModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-dark text-light">
          <div class="modal-header">
            <h5 class="modal-title" id="conversationModalLabel">Detalhes da Conversa</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="conversation-content">
            <p>Carregando mensagens...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/conversations.js"></script>
    <script>
        protectPage();

        // Filtros e busca
        const searchInput = document.getElementById('search-conversation');
        const statusFilter = document.getElementById('status-filter');
        const refreshBtn = document.getElementById('refresh-btn');

        searchInput.addEventListener('input', filterConversations);
        statusFilter.addEventListener('change', filterConversations);
        refreshBtn.addEventListener('click', loadConversations);

        function filterConversations() {
            const searchValue = searchInput.value.toLowerCase();
            const statusValue = statusFilter.value;
            const conversations = document.querySelectorAll('.conversation-item');

            conversations.forEach(item => {
                const name = item.dataset.name.toLowerCase();
                const status = item.dataset.status;

                const matchesSearch = name.includes(searchValue);
                const matchesStatus = statusValue === 'all' || status === statusValue;

                item.style.display = matchesSearch && matchesStatus ? '' : 'none';
            });
        }

        // SimulaÃ§Ã£o: carregar conversas (vocÃª pode integrar ao backend depois)
        function loadConversations() {
            const container = document.getElementById('conversations-container');
            container.innerHTML = `
                <a href="#" class="list-group-item list-group-item-action bg-dark text-light conversation-item" 
                   data-name="Cliente 1" data-status="active" onclick="openConversation('Cliente 1')">
                    ðŸ’¬ <strong>Cliente 1</strong> - conversa ativa
                </a>
                <a href="#" class="list-group-item list-group-item-action bg-dark text-light conversation-item" 
                   data-name="Cliente 2" data-status="closed" onclick="openConversation('Cliente 2')">
                    ðŸ’¬ <strong>Cliente 2</strong> - conversa finalizada
                </a>
            `;
        }

        // Modal de conversa
        function openConversation(name) {
            const modal = new bootstrap.Modal(document.getElementById('conversationModal'));
            const content = document.getElementById('conversation-content');
            content.innerHTML = `<p><strong>${name}</strong><br><br>Mensagem 1: OlÃ¡!<br>Mensagem 2: Como posso te ajudar?</p>`;
            modal.show();
        }

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', loadConversations);
    </script>
</body>
</html>
